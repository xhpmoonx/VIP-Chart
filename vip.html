<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
            <title>Curriculum Graph - VIP Course</title>
                <style>
                  
body {
  font-family: system-ui, sans-serif;
  background: #f8fafc;
  padding: 40px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(8, 200px);
  grid-template-rows: repeat(7, 100px) auto;
  gap: 20px;
  position: relative;
  width: max-content;
}

.course {
  background: transparent;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

/* Circle (default) */
.circle {
  width: 30px;
  height: 30px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 6px;
  background: yellow;
  border: 3px solid #ef4444;
}

/* Circle types */
.course[data-type="core"] .circle {
  border-radius: 50%;
}

.course[data-type="ge"] .circle {
  border-radius: 8px;
}

.course[data-type="elective"] .circle {
  border-radius: 999px;
  width: 60px;
  height: 28px;
}

/* Triangle (capstone) outer */
.triangle {
  position: relative;
  width: 0;
  height: 0;
  border-left: 24px solid transparent;
  border-right: 24px solid transparent;
  border-bottom: 42px solid #ef4444;
  margin-bottom: 6px;
}

/* Triangle fill */
.triangle::before {
  content: "";
  position: absolute;
  top: 4px;
  left: -20px;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-bottom: 34px solid yellow;
  z-index: 1;
}

/* Triangle units text */
.triangle::after {
  content: attr(data-units);
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  font-size: 0.9em;
  color: black;
  z-index: 2;
  pointer-events: none;
}

/* Highlight states */
.course.direct-blocked .circle {
  background: #e0f2fe;
  border-color: #1a835b;
}

.course.direct-blocked .triangle {
  border-bottom-color: #1a835b;
  opacity: 0.6;
}

.course.direct-blocked .triangle::before {
  border-bottom-color: #e0f2fe;
}

.course.indirect-blocked .circle {
  background: #f0f9ff;
  border-color: #70a3e0;
}

.course.indirect-blocked .triangle {
  border-bottom-color: #70a3e0;
}

.course.indirect-blocked .triangle::before {
  border-bottom-color: #f0f9ff;
}

.course.dependency .circle {
  border-color: #381a04;
}

.course.dependency .triangle {
  border-bottom-color: #381a04;
}

/* Hover state */
.course:hover .circle {
  border-color: #3b82f6;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}

.course:hover .triangle {
  border-bottom-color: #3b82f6;
  filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.5));
}

/* Grid dimmed state */
.grid.dimmed .course:not(.active) .circle {
  border-color: #94a3b8;
  background: #f1f5f9;
  color: #94a3b8;
  opacity: 0.3;
  box-shadow: none;
}

.grid.dimmed .arrow:not(.highlighted) {
  opacity: 0.1;
}

.course.active .circle {
  border-color: #3b82f6;
  background: yellow;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}


.label {
  font-size: 0.85em;
  color: #0f172a;
  text-align: center;
}

.arrow {
  stroke: #ef4444;
  stroke-width: 2.5;
  fill: none;
  opacity: 0.3;
  transition: stroke 0.2s ease, opacity 0.2s ease;
}

.arrow.highlighted {
  stroke: #3b82f6;
  opacity: 1;
}

.popup {
  position: absolute;
  background: white;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.85em;
  color: #0f172a;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  pointer-events: none;
  z-index: 20;
  display: none;
  white-space: nowrap;
}

svg {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 10;
  pointer-events: none;
}

.layout {
  display: grid;
  grid-template-columns: 1fr 200px;
  height: 100vh;
  overflow: hidden;
}

.main-content {
  overflow: auto;
  padding: 40px;
  position: relative;
}

.key {
  background: white;
  border-left: 1px solid #e2e8f0;
  padding: 20px;
  font-size: 0.9em;
  color: #0f172a;
  box-shadow: -2px 0 8px rgba(0,0,0,0.04);
  height: 100%;
  position: relative;
  z-index: 10;
}

.key .circle.example {
  width: 22px;
  height: 22px;
  font-size: 0.8em;
  margin-right: 10px;
  background: yellow;
  border: 2px solid #ef4444;
}

.key-line {
  display: inline-block;
  width: 30px;
  height: 3px;
  margin-right: 10px;
  background: #ef4444;
}

.key-line.prereq {
  opacity: 0.3;
}

.key-line.blocked {
  background: #3b82f6;
}

.key-line.all {
  background: #475569;
}


.grid {
  display: grid;
  grid-template-columns: repeat(8, 200px);
  grid-template-rows: repeat(7, 100px) auto;
  gap: 20px;
  position: relative;
  width: max-content;
}

.course {
  background: transparent;
  padding: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

/* === SHAPES === */

/* Default circle */
.circle {
  width: 30px;
  height: 30px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 6px;
  background: yellow;
  border: 3px solid #ef4444;
}

/* Core: rounded */
.course[data-type="core"] .circle {
  border-radius: 50%;
}

/* GE: square */
.course[data-type="ge"] .circle {
  border-radius: 8px;
}

/* Elective: pill */
.course[data-type="elective"] .circle {
  border-radius: 999px;
  width: 60px;
  height: 28px;
}

/* Capstone: triangle */
.course[data-type="capstone"] .triangle {
  position: relative;
  width: 0;
  height: 0;
  border-left: 24px solid transparent;
  border-right: 24px solid transparent;
  border-bottom: 42px solid #ef4444;
  margin-bottom: 6px;
}

/* Triangle inner yellow fill */
.course[data-type="capstone"] .triangle::before {
  content: "";
  position: absolute;
  top: 4px;
  left: -20px;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-bottom: 34px solid yellow;
  z-index: 1;
}

/* Units label */
.course[data-type="capstone"] .triangle::after {
  content: attr(data-units);
  position: absolute;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  font-size: 0.9em;
  color: black;
  z-index: 2;
  pointer-events: none;
}

/* === LABEL === */
.label {
  font-size: 0.85em;
  color: #0f172a;
  text-align: center;
}

/* === STATES === */

/* Hover effect */
.course:hover .circle {
  border-color: #3b82f6 !important;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}

.course:hover[data-type="capstone"] .triangle {
  border-bottom-color: #3b82f6 ;
  filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.5)) !important;
}

/* Directly Blocked */
.course.direct-blocked .circle {
  background: #e0f2fe !important;
  border-color: #1a835b !important;
  box-shadow: 0 0 6px rgba(5, 90, 226, 0.79) !important;
}

.course.direct-blocked .triangle {
  border-bottom-color: #1a835b ;
  filter: drop-shadow(0 0 6px rgba(5, 90, 226, 0.79)) !important;
}

/* Indirectly Blocked */
.course.indirect-blocked .circle {
  background: #f1f5f9;
  border-color: #70a3e0 !important;
  opacity: 0.9 !important;
}

.course.indirect-blocked .triangle {
  border-bottom-color: #70a3e0 ;
  opacity: 0.6;
}

/* Dependency */
.course.dependency .circle {
  background: #fef3c7 !important;
  border-color: #381a04 !important;
}

.course.dependency .triangle {
  border-bottom-color: #381a04 ;
}

/* === Arrows === */
svg {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 10;
  pointer-events: none;
}

.arrow {
  stroke: #ef4444;
  stroke-width: 2.5;
  fill: none;
  transition: stroke 0.2s ease, opacity 0.2s ease;
  opacity: 0.3;
}

.arrow.highlighted {
  stroke: #3b82f6;
  opacity: 1;
}

/* === Popup === */
.popup {
  position: absolute;
  background: white;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.85em;
  color: #0f172a;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  pointer-events: none;
  z-index: 20;
  display: none;
  white-space: nowrap;
}

/* === Dim + Active === */
.grid.dimmed .course:not(.active) .circle {
  border-color: #94a3b8;
  background: #f1f5f9;
  color: #94a3b8;
  opacity: 0.3;
  box-shadow: none;
}

.grid.dimmed .arrow:not(.highlighted) {
  opacity: 0.1;
}

.course.active .circle {
  border-color: #3b82f6;
  background: yellow;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}

/* === Key Sidebar === */
.key {
  background: white;
  border-left: 1px solid #e2e8f0;
  padding: 20px;
  font-size: 0.9em;
  color: #0f172a;
  box-shadow: -2px 0 8px rgba(0,0,0,0.04);
  height: 100%;
  position: relative;
  z-index: 10;
}

.key h3 {
  margin-top: 0;
  font-size: 1em;
  margin-bottom: 8px;
}

.key ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.key li {
  display: flex;
  align-items: center;
  margin-bottom: 6px;
}

.key .circle.example {
  width: 22px;
  height: 22px;
  font-size: 0.8em;
  margin-right: 10px;
  background: yellow;
  border: 2px solid #ef4444;
}

.key-line {
  display: inline-block;
  width: 30px;
  height: 3px;
  margin-right: 10px;
  background: #ef4444;
}

.key-line.prereq {
  opacity: 0.3;
}

.key-line.blocked {
  background: #3b82f6;
}

.key-line.all {
  background: #475569;
}


.grid {
  display: grid;
  grid-template-columns: repeat(8, 200px);
  grid-template-rows: repeat(7, 100px) auto;
  gap: 20px;
  position: relative;
  width: max-content;
}

.term-header {
  text-align: center;
  font-weight: bold;
  color: #0f172a;
  font-size: 1.2em;
  grid-row: 1;
}

.term-footer {
  font-size: 0.9em;
  color: #475569;
  text-align: center;
  grid-row: 6;
}

.course {
  background: transparent;
  padding: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

/* === Circles & Base Shapes === */
.circle {
  width: 30px;
  height: 30px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 6px;
  background-color: yellow;
  border-radius: 50%;
  transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

.course[data-type="ge"] .circle {
  border-radius: 8px;
}

.course[data-type="elective"] .circle {
  border-radius: 999px;
  width: 60px;
  height: 28px;
}

/* === Triangle Shape === */
/* Base triangle structure */
.triangle {
  position: relative;
  width: 0;
  height: 0;
  border-left: 24px solid transparent;
  border-right: 24px solid transparent;
  border-bottom: 42px solid #ef4444;
  margin-bottom: 6px;
}

/* Inner triangle for background fill */
.triangle::before {
  content: "";
  position: absolute;
  top: 4px;
  left: -20px;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-bottom: 34px solid yellow; /* default fill */
  z-index: 1;
}

/* Units text inside triangle */
.triangle::after {
  content: attr(data-units);
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  font-size: 0.9em;
  color: black;
  z-index: 2;
  pointer-events: none;
}



/* === Hover / Active === */
.course:hover .circle {
  background-color: #e0f2fe;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}

.course:hover[data-type="capstone"] .triangle {
  border-bottom-color: #3b82f6;
  filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.5));
}

.course.active .circle {
  background-color: #fef08a;
  box-shadow: 0 0 8px rgba(59, 130, 246, 0.5);
}

.course.active .triangle::before {
  border-bottom-color: #fef08a;
}

/* === State-based Backgrounds === */
.course.direct-blocked .circle {
  background-color: #d1fae5 !important;
}

.course.indirect-blocked .circle {
  background-color: #dbeafe !important;
  opacity: 0.6;
}

.course.dependency .circle {
  background-color: #fde68a !important;
}

.course.direct-blocked .triangle::before {
  border-bottom-color: #d1fae5 !important;
}

.course.indirect-blocked .triangle::before {
  border-bottom-color: #dbeafe !important;
  opacity: 0.6;
}

.course.dependency .triangle::before {
  border-bottom-color: #fde68a !important;
}

/* === Dimming when one course is focused === */
.grid.dimmed .course:not(.active) .circle {
  background-color: #f1f5f9;
  color: #94a3b8;
  opacity: 0.3;
  box-shadow: none;
}

.grid.dimmed .course:not(.active) .triangle::before {
  border-bottom-color: #f1f5f9;
  opacity: 0.3;
}

.grid.dimmed .arrow:not(.highlighted) {
  opacity: 0.1;
}
.course.dimmed-triangle .triangle {
  border-bottom-color: #f1f5f9 !important;
  filter: none !important;
  opacity: 0.3;
}

.course.dimmed-triangle .triangle::before {
  border-bottom-color: #f1f5f9 !important;
  opacity: 0.3;
}


/* === Arrows === */
.arrow {
  stroke: #ef4444;
  stroke-width: 2.5;
  fill: none;
  transition: stroke 0.2s ease, opacity 0.2s ease;
  opacity: 0.3;
}

.arrow.highlighted {
  stroke: #3b82f6;
  opacity: 1;
}

/* === Misc === */
.label {
  font-size: 0.85em;
  color: #0f172a;
  text-align: center;
}

.popup {
  position: absolute;
  background: white;
  border: 1px solid #cbd5e1;
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.85em;
  color: #0f172a;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  pointer-events: none;
  z-index: 20;
  display: none;
  white-space: nowrap;
}

.layout {
  display: grid;
  grid-template-columns: 1fr 200px;
  height: 100vh;
  overflow: hidden;
}

.main-content {
  overflow: auto;
  padding: 40px;
  position: relative;
}

.key {
  background: white;
  border-left: 1px solid #e2e8f0;
  padding: 20px;
  font-size: 0.9em;
  color: #0f172a;
  box-shadow: -2px 0 8px rgba(0,0,0,0.04);
  height: 100%;
  position: relative;
  z-index: 10;
}

.key h3 {
  margin-top: 0;
  font-size: 1em;
  margin-bottom: 8px;
}

.key ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.key li {
  display: flex;
  align-items: center;
  margin-bottom: 6px;
}

.key .circle.example {
  width: 22px;
  height: 22px;
  font-size: 0.8em;
  margin-right: 10px;
  background: yellow;
  border: 2px solid #ef4444;
}

.key-line {
  display: inline-block;
  width: 30px;
  height: 3px;
  margin-right: 10px;
  background: #ef4444;
}

.key-line.prereq {
  opacity: 0.3;
}

.key-line.blocked {
  background: #3b82f6;
}

.key-line.all {
  background: #475569;
}

                </style>
    </head>
<body>

  <div class="layout">
    <div class="main-content">
      <div id="popup" class="popup"></div>
  
      <div class="grid" id="curriculum">
        <svg id="svg" width="1000" height="800">
          <defs>
            <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5"
              markerWidth="4" markerHeight="4" orient="auto">
            </marker>
          </defs>
        </svg>
      </div>
    </div>
  
    <div class="key">
   <!-- === KEY TITLE === -->
<div style="font-weight: 600; font-size: 0.9em; color: #334155; margin-bottom: 12px;">
  Course Flow Key
</div>

<!-- === HOVER STATES === -->
<div style="font-size: 0.85em; color: #475569; font-weight: 500; margin: 18px 0 6px;">
  Course Path Colors
</div>
<ul>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="background: #fef08a; border: 2px solid #3b82f6; box-shadow: 0 0 6px rgba(59,130,246,0.5);"></div>
    Hovered Course (Yellow)
  </li>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="background: #d1fae5; border: 2px solid #1a835b;"></div>
    Directly Blocked (Green)
  </li>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="background: #dbeafe; border: 2px solid #70a3e0;"></div>
    Indirectly Blocked (Blue)
  </li>
  <li style="margin-bottom: 12px;">
    <div class="circle example" style="background: #fef3c7; border: 2px solid #381a04;"></div>
    Prerequisite (Dark Red Border)
  </li>
</ul>

<!-- === COURSE TYPES === -->
<div style="font-size: 0.85em; color: #475569; font-weight: 500; margin: 10px 0 6px;">
  Course Types
</div>
<ul>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="border-radius: 50%; border: 2px solid #ef4444;"></div>
    Core Course
  </li>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="border-radius: 8px; border: 2px solid #ef4444;"></div>
    GE Course
  </li>
  <li style="margin-bottom: 8px;">
    <div class="circle example" style="border-radius: 999px; width: 50px; height: 24px; border: 2px solid #ef4444; display: flex; align-items: center; justify-content: center;"></div>
    Elective Course
  </li>
  <li style="margin-bottom: 12px;">
    <div class="triangle" style="transform: scale(0.6); border-bottom-color: #ef4444; position: relative; margin-right: 8px;">
      <div style="position: absolute; top: 4px; left: -20px; border-left: 20px solid transparent; border-right: 20px solid transparent; border-bottom: 34px solid yellow;"></div>
    </div>
    Capstone
  </li>
</ul>

<!-- === ARROW MEANINGS === -->
<div style="font-size: 0.85em; color: #475569; font-weight: 500; margin: 18px 0 6px;">
  Arrow Types
</div>
<ul>
  <li style="margin-bottom: 8px;"><span class="key-line prereq"></span> Prerequisite Path</li>
  <li><span class="key-line blocked"></span> Highlighted Dependency</li>
</ul>

    </div>
  </div>

  <script>
    let curriculum = [];
    let arrows = [];

    fetch('curriculum.json')
    .then(res => res.json())
    .then(data => {
      curriculum = data;
      arrows = curriculum.flatMap(course =>
        course.prereqs.map(pr => ({ from: pr, to: course.id }))
      );
      renderCourses();
      markUnmetPrereqs();
      requestAnimationFrame(() => {
        renderArrows();
      });
    })
    .catch(err => console.error("Failed to load curriculum.json:", err));

    function markUnmetPrereqs() {
      curriculum.forEach(course => {
        const courseTerm = course.term;
        const unmet = course.prereqs.filter(prereqId => {
          const prereq = curriculum.find(c => c.id === prereqId);
          return prereq && prereq.term >= courseTerm;
        });

        if (unmet.length) {
          const el = document.getElementById(course.id);
          el.classList.add('unmet');
        }
      });
    }


    function createCourse(course) {
  const div = document.createElement("div");
  div.className = "course";
  div.id = course.id;
  div.dataset.type = course.type;
  div.style.gridColumn = course.term;
  div.style.gridRow = course.row;

  const shapeEl = document.createElement("div");

  if (course.type === "capstone") {
    shapeEl.className = "triangle";
    shapeEl.dataset.units = course.units;
  } else {
    shapeEl.className = "circle";
    shapeEl.textContent = course.units;
  }

  const label = document.createElement("div");
  label.className = "label";
  label.innerHTML = course.label;

  div.appendChild(shapeEl);
  div.appendChild(label);
  return div;
}


    function renderCourses() {
      const grid = document.getElementById("curriculum");
      curriculum.forEach(course => {
        const el = createCourse(course);
        grid.appendChild(el);
      });
    }
    //Draws one curved SVG arrow between two course circles
    function drawArrow(fromId, toId) {
        const svg = document.getElementById('svg');
        const fromShape = document.querySelector(`#${fromId} .circle, #${fromId} .triangle`);
        const toShape = document.querySelector(`#${toId} .circle, #${toId} .triangle`);
        if (!fromShape || !toShape) return;

        const svgRect = svg.getBoundingClientRect();
        const from = fromShape.getBoundingClientRect();
        const to = toShape.getBoundingClientRect();

        const startX = from.right - svgRect.left;
        const startY = from.top + from.height / 2 - svgRect.top;

        const endX = to.left - svgRect.left;
        const endY = to.top + to.height / 2 - svgRect.top;

        const curveY = 30; //makes it subtler or more pronounced
        const dx = endX - startX;
        const curveX = Math.max(40, Math.min(dx / 2, 80)); // horizontal curve

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("class", "arrow");
        path.setAttribute("d",`M ${startX} ${startY} C ${startX + curveX} ${startY - curveY}, ${endX - curveX} ${endY - curveY}, ${endX} ${endY}`);        
        // Store the source course ID so we can highlight it later
        path.dataset.from = fromId;
        path.dataset.to = toId;

        svg.appendChild(path);
        }
    //Clears and redraws all arrows, and adds hover listeners
    function renderArrows() {
        const svg = document.getElementById('svg');
        const grid = document.getElementById('curriculum');
        const gridRect = grid.getBoundingClientRect();

        svg.setAttribute('width', grid.scrollWidth);
        svg.setAttribute('height', grid.scrollHeight);
        //Remove all existing arrows from the SVG
        svg.querySelectorAll('.arrow').forEach(e => e.remove()); 
        //Loop through arrow list and draw each one
        arrows.forEach(({ from, to }) => {drawArrow(from, to);});
        document.querySelectorAll('.course').forEach(course => {
        course.addEventListener('mouseenter', () => {
          highlightArrows(course.id); // highlight dependencies on hover
        });

        course.addEventListener('mouseleave', () => {
          clearHighlights(); // remove highlights when mouse leaves
        });

        course.addEventListener('click', (e) => {
          e.stopPropagation(); // prevent body click from clearing popup
          showCourseInfo(course); // show info popup
        });
      });

      // Hide popup when clicking anywhere else
      document.addEventListener('click', () => {
        document.getElementById('popup').style.display = 'none';
      });

        //Hide popup if you click anywhere else on the page
            document.addEventListener('click', () => {
            document.getElementById('popup').style.display = 'none';
            });
    }
    //Highlights all arrows that start from a given course
    function highlightArrows(courseId) {
  const grid = document.getElementById('curriculum');
  grid.classList.add('dimmed');

  // Highlight connected arrows
  document.querySelectorAll('.arrow').forEach(path => {
    path.classList.remove('highlighted');
    if (path.dataset.from === courseId || path.dataset.to === courseId) {
      path.classList.add('highlighted');
    }
  });

  // Remove all visual states
  document.querySelectorAll('.course').forEach(el => {
    el.classList.remove('active', 'direct-blocked', 'indirect-blocked', 'dependency', 'dimmed-triangle');
  });

  const activeCourse = document.getElementById(courseId);
  if (activeCourse) activeCourse.classList.add('active');

  const direct = arrows.filter(a => a.from === courseId).map(a => a.to);
  const indirect = new Set();
  const prereqs = arrows.filter(a => a.to === courseId).map(a => a.from);

  // Get all indirect blocked
  const visited = new Set(direct);
  const queue = [...direct];
  while (queue.length) {
    const current = queue.shift();
    arrows.filter(a => a.from === current).forEach(a => {
      if (!visited.has(a.to)) {
        visited.add(a.to);
        indirect.add(a.to);
        queue.push(a.to);
      }
    });
  }

  // Apply styles
  direct.forEach(id => {
    document.getElementById(id)?.classList.add('direct-blocked');
  });

  indirect.forEach(id => {
    if (!direct.includes(id)) {
      document.getElementById(id)?.classList.add('indirect-blocked');
    }
  });

  prereqs.forEach(id => {
    document.getElementById(id)?.classList.add('dependency');
  });

  // Now, dim unrelated triangles ONLY
  document.querySelectorAll('.course').forEach(course => {
    const related =
      course.id === courseId ||
      direct.includes(course.id) ||
      indirect.has(course.id) ||
      prereqs.includes(course.id);

    const triangle = course.querySelector('.triangle');
    if (triangle && !related) {
      course.classList.add('dimmed-triangle');
    }
  });
}


    //Removes all arrow highlights (when hover ends)
    function clearHighlights() {
  const grid = document.getElementById('curriculum');
  grid.classList.remove('dimmed');

  document.querySelectorAll('.arrow').forEach(path => {
    path.classList.remove('highlighted');
  });

  document.querySelectorAll('.course').forEach(el => {
    el.classList.remove(
      'active',
      'direct-blocked',
      'indirect-blocked',
      'dependency',
      'dimmed-triangle' 
    );
  });
}


    //Show popup box with course info (prereqs and dependencies)
    function showCourseInfo(courseEl) {
  const id = courseEl.id;
  const course = curriculum.find(c => c.id === id);
  if (!course) return;

  const prereqFor = arrows.filter(a => a.from === id).map(a => a.to);
  const dependsOn = arrows.filter(a => a.to === id).map(a => a.from);

  const lines = [];
  lines.push(`<strong>${course.label.replace('\n', ' ')}</strong>`);
  lines.push(`Units: ${course.units}`);

  if (dependsOn.length) {
    const labels = dependsOn.map(depId =>
      curriculum.find(c => c.id === depId)?.label?.split('\n')[0] || depId
    );
    lines.push("Depends on: " + labels.join(", "));
  }

  if (prereqFor.length) {
    const labels = prereqFor.map(prId =>
      curriculum.find(c => c.id === prId)?.label?.split('\n')[0] || prId
    );
    lines.push("Prerequisite for: " + labels.join(", "));
  }

  if (!dependsOn.length && !prereqFor.length) {
    lines.push("No direct connections");
  }

  const popup = document.getElementById('popup');
  popup.innerHTML = lines.join("<br>");
  popup.style.display = 'block';

  // Get the actual screen position of the course element
  const rect = courseEl.getBoundingClientRect();

  // Position the popup relative to the screen
  popup.style.position = 'fixed';
  popup.style.left = `${rect.left}px`;
  popup.style.top = `${rect.bottom + 6}px`; // 6px below the course
}

    window.addEventListener('load', renderArrows);
    window.addEventListener('resize', renderArrows);
  </script>
</body>
</html>
